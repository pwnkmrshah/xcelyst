<style type="text/css">
	span.remove-file{
		cursor: pointer;
		color: #38678b;
	}
	span.remove-resume-link{
		cursor: pointer;
		color: #38678b;
	}
</style>
<% if action_name == "new" || action_name == "create"%>
  <% url = admin_candidates_path %>
  <% button_label = 'Create' %>
<% elsif action_name == "update" || action_name == "edit" %>
  <% url = admin_candidate_path(@candidate) %>
  <% button_label = 'Update' %>
<% end %>
<%= form_with(model: resource, url: url, local: true) do |form| %>
  <div>
    <%= form.label :first_name, 'First Name:' %>
    <%= form.text_field :first_name %>
  </div>

  <div>
    <%= form.label :last_name, 'Last Name:' %>
    <%= form.text_field :last_name %>
  </div>

  <div>
    <%= form.label :current_city, 'Current City:' %>
    <%= form.text_field :current_city %>
  </div>

  <div>
    <%= form.label :email, 'Email:' %>
    <%= form.text_field :email %>
  </div>

  <div>
    <%= form.label :phone_number, 'Phone Number:' %>
    <%= form.text_field :phone_number %>
  </div>
  <br>


  <div>
    <%= form.label :resume, 'Upload Resume:' %>
    <%= form.file_field :resume, onchange: "displayFileName(this)" %>
    <% if form.object.user_resume.present? %>
    	<% if form.object.resume_image.present? %>
	      <label class="file-name"><%= form.object.resume_image.filename %></label>
	      <br>
	      <span>
	        <%= link_to 'Download Resume', url_for(form.object.resume_image), target: '_blank' %><br>
	      <span class="remove-resume-link">
	        Remove Resume
	      </span>
	      </span>
      <% else %>
	      <span class="remove-file">
	        Remove Resume
	      </span>
      <% end %>
      <br>
    <% end %>
  </div>	
	<br>
  <fieldset class="actions">
    <ol>
      <li class="action input_action" id="contact_submit_action">
        <%= form.submit "#{button_label} candidate", data: { disable_with: "#{button_label} candidate" } %>
      </li>
      <li class="cancel"><a href="/admin/candidates">Cancel</a></li>
    </ol>
  </fieldset>
<% end %>

<script>
  function displayFileName(input) {
    var fileName = input.files[0].name;
    var fileLabel = input.parentElement.querySelector('.file-name');
    if (fileLabel) {
      fileLabel.textContent = fileName;
    }
  }

  $('.remove-file').click(function(event) {
    event.preventDefault();
    var resumeFileField = $('input[type="file"]');
    resumeFileField.val(null);
    var fileLabel = resumeFileField.parent().find('.file-name');
    if (fileLabel) {
      fileLabel.text('');
    }
  });

  $('.remove-resume-link').click(function(event) {
    event.preventDefault();

    var removeUrl = "<%= remove_resume_account_block_accounts_path %>";
    var userId = "<%= resource.id %>";
    var $removeLink = $(this);

    $removeLink.prop('disabled', true).text('Removing Resume...').css('color', 'black');

    $.ajax({
      url: removeUrl,
      method: 'PUT',
      data: {user_id: userId},
      success: function(response) {
      	if (response.success) {
	      	alert(response.message)
	        location.reload();
      	}
      },
    });
  });

</script>
